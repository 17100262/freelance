<div class="container p-4">
	<div class="featured-boxes featured-boxes-style-8">
    <div class="row">
	    <div class="col-md-8">
	      <div class="heading heading-primary heading-border heading-bottom-border">
          <h1><%= @job.title %></h1>
        </div>
        <div class="featured-box featured-box-primary featured-box-text-left grey-bg mb-0">
    			<div class="box-content">
    			  <h3 class="mb-0 text-capitalize">Description:</h3>
          </div>
        </div>
        <div class="featured-box featured-box-primary featured-box-text-left mt-0">
    			<div class="box-content">
            <%= @job.description %>    
          </div>
        </div>

        <div class="featured-box featured-box-primary featured-box-text-left grey-bg mb-0">
    			<div class="box-content">
    			  <h3 class="mb-0 text-capitalize">Deliverables:</h3>
          </div>
        </div>
        <div class="featured-box featured-box-primary featured-box-text-left mt-0">
    			<div class="box-content">
            <%= @job.deliverables %>
          </div>
        </div>
        
      </div>
      <div class="col-md-4">
        <div class="featured-box featured-box-primary featured-box-text-left mt-0">
    			<div class="box-content p-mb-0">
            <p>
              <strong>Duration:</strong>
              <%= @job.duration %>
            </p>
            
            <p>
              <strong>Language:</strong>
              <%= @job.language %>
            </p>
            
            <p>
              <strong>Amount:</strong>
              <%= @job.amount %>
            </p>
            
            <p>
              <strong>Online/Local:</strong>
              <%= @job.online ? "Online" : "Local" %>
            </p>
            <% if !@job.online %>
              <p>
                <strong>Address:</strong>
                <%= @job.address %>
              </p>
            <% end %>
            
            <p>
              <strong>User:</strong>
              <%= @job.user.email %>
            </p>
            
            <!--< if user_signed_in? and current_user == @job.user %>-->
            
              <div id="paypal-button-container"></div>
              <script src="https://www.paypalobjects.com/api/checkout.js"></script>
              <script>
                  paypal.Button.render({
          
                      env: 'sandbox', // sandbox | production
          
                      // PayPal Client IDs - replace with your own
                      // Create a PayPal app: https://developer.paypal.com/developer/applications/create
                      client: {
                          sandbox:    'AUGtdvwIyLdniSiPb0gaPf2AeFSyh1axyKx3vLxml0-2GAccXA8gY6piVVW8OwsSZjkILon7_5i3TRSe',
                          production: '<insert production client id>'
                      },
          
                      // Show the buyer a 'Pay Now' button in the checkout flow
                      commit: true,
          
                      // payment() is called when the button is clicked
                      payment: function(data, actions) {
          
                          // Make a call to the REST api to create the payment
                          return actions.payment.create({
                              payment: {
                                  transactions: [
                                      {
                                          amount: { total: '<%= @job.amount %>', currency: 'USD' }
                                      }
                                  ]
                              },
                              experience: {
                                  input_fields: {
                                      no_shipping: 1
                                  }
                              }
                          });
                      },
          
                      // onAuthorize() is called when the buyer approves the payment
                      onAuthorize: function(data, actions) {

                      // Get the payment details

                        return actions.payment.get().then(function(data) {
            
                              // Execute the payment
                              return actions.payment.execute().then(function() {
                              });
                          });
                      
                  }
          
                  }, '#paypal-button-container');
          
              </script>
            
            <!--< end %>-->
             <!--if current user not in blocked users-->
              <% if user_signed_in? %>
                <% if @blocked.include?  current_user.id %>
                  <p>You cannot place a reservation on this job as you are blocked from this Job.</p>
                <% else %>
                  <!--RESERVE FORM-->
                  <% if !@job.reservations.exists?(user: current_user) %>
                    <%= form_for(@job.reservations.new) do |form| %>
                        <%= form.hidden_field :job_id, id: :reservation_job_id,value: @job.id %>
                        <%= form.hidden_field :user_id, id: :reservation_user_id,value: current_user.id %>
                        <% ending_time = (@job.duration / Variable.find_by_name("RESERVATION_FACTOR").value.to_f)*24*60*60 %>
                        <%= form.hidden_field :ending_time, id: :reservation_ending_time,value: (Time.now + ending_time.seconds) %>
                    
                      <div class="actions">
                        <%= form.submit "Make Reservation", class: "login loginmodal-button loginmodal-submit mt-1" %>
                      </div>
                    <% end %>
                  <% else %>
                    You already have a reservation on this job.
                    <%= link_to "View Reservation", reservation_path(@job.reservations.where(user: current_user).first.slug), class:"login loginmodal-button loginmodal-submit mt-1" %>
                  <% end %>
                <% end %>
              <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>  
</div>